<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" href="../../favicon.ico">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin=""/>

  <!-- java script -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>


  <!-- Leaflet JS (after the CSS!) -->
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
      integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
      crossorigin=""></script>

  <title>Plan-It Results!</title>

  <!-- Bootstrap core CSS -->
  <link href="../static/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="../static/css/bootstrap-template.css" rel="stylesheet">

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>

<body>
    <div class="container">
    <div class="header clearfix">
      <nav>
        <ul class="nav nav-pills pull-left">
          <!-- don't forget to link pages back to home-->
          <li role="presentation"><a href="/">&larr; Back to Home</a></li>
        </ul>
      </nav>
    </div>
<br><br>


<div class="container">
  <!--here's the input container so you can query after output is served-->
  <div id="outmap" style=" position: relative;
                           top: 0px;
                           left: 00px;
                           bottom: 0;
                           right: 0;
                           width: 750px;
                           height: 500px;
                           overflow: auto;"></div>

  <script type=text/javascript>

       var outmap = L.map('outmap').setView([40.0150, -105.2705], 11);

       L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
           attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
       }).addTo(outmap);

        // Test a polyline to sanity check
        var polylinePoints = [[40.0150, -105.2705], [39.9950, -105.2805]];
        var polyline = L.polyline(polylinePoints).addTo(outmap);

//   AJE:  This is the section that I don't really know whats going on
       var queryDict = {};
       location.search.substr(1).split("&").forEach(function(item) {queryDict[item.split("=")[0]] = item.split("=")[1]});

//       var gpx_lines = queryDict['gpx_tracks'];
//     gpx_lines *should* be :
//     gpx_lines = {  'route' : [], integer list of route index,
//                    'gpx'   : [ [(lat,long,elev)...],  [(lat,long,elev)] ] }
//
//           so 'gpx' contains an array containing arrays of (lat,long,elev) coordinates:
//
//       var gpx_lines = JSON.parse(queryDict['gpx_tracks']);  // tried with JSON and without... both don't work

  //     for (var i = 0; i < gpx_lines.length; i++){
         //var trailPoints = gpx_lines[i]['gpx'];
    //     var polyline = L.polyline(gpx_lines[i]['gpx']).addTo(outmap);
      // }

     </script>


 </div>

   <div class="container">
     <div class="starter-template">
       <h2>Results:</h2>
       <p class="lead">Here are the suggested routes! Click on the GPX links to download a GPX file for each route!</p>
     </div>

     <table class="table table-hover">
     <tr><th>Route</th><th>Distance ({{du}})</th><th>Elev. + ({{eu}})</th><th>Elev. - ({{eu}})</th>
         <th>Max Elev. ({{eu}})</th><th>Min Elev. ({{eu}})</th><th>Max Grade (%)</th><th>Min Grade (%)</th><th> % Repeated</th>
         <th>Download Link</th></tr>
     {% for trail in trailroutes %}
     <tr><td>{{ trail['route'] }}</td><td>{{ trail['distance']}}</td><td> {{ trail['elevation_gain'] }}</td><td> {{ trail['elevation_loss'] }}</td>
              <td>{{trail['max_altitude']}}</td><td>{{trail['min_altitude']}}</td><td>{{trail['max_grade']}}</td><td>{{trail['min_grade']}}</td>
              <td>{{trail['repeated_percent']}}</td>
              <td><button class="btn btn-xs btn-primary">GPX</button></td>
             </tr>
     {% endfor %}
     </table>


    </div><!-- /.container -->

   <div class="container">


<!--
     <div class="starter-template">
       <h3>Another Result:</h3>
       <p class="lead">Now we've taken the input and called a function from your package.<br>The result is {{the_result}}</p>
     </div> -->

     <form action="/" method="GET">
       <div>
         <button type="submit"  class="btn btn-default btn-lg">Reset and Compute a New Route!</button>
       </div>
    </form>


     <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
     <script src="static/js/bootstrap.min.js"></script>


    </div><!-- /.container -->


  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="static/js/bootstrap.min.js"></script>
  </body>
</html>
