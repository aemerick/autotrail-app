<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin=""/>

  <!-- java script -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>


  <!-- Leaflet JS (after the CSS!) -->
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
      integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
      crossorigin=""></script>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" href="../../favicon.ico">

  <title>Plan-It Trails</title>

  <!-- Bootstrap core CSS -->
  <link href="../static/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="../static/css/bootstrap-template.css" rel="stylesheet">

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>

<!--
<body>
    <div class="container">
    <div class="header clearfix">
      <nav>
        <ul class="nav nav-pills pull-left">
          <li role="presentation"><a href="/">&larr; Home</a></li>
        </ul>
      </nav>
    </div>
<br><br>
-->

  <!--here's the input container -->
  {% if error %}
    <p class=error><strong>Error:</strong> {{ error }}
  {% endif %}


<!--
  <head>
      {{ hdr_txt  }}
  </head>
  <body>
      <hr/>
      {{ map_div }}
      <hr/>
  </body>
  {# Note: script_txt MUST follow the body, so that div ids are defined to be referenced in the scripts #}
  <script>
      {{ script_txt }}
  </script>
-->

<div class="container">

  <div id="homemap" style=" position: relative;
                           top: 0px;
                           left: 0px;
                           bottom: 0;
                           right: 0;
                           width: 750px;
                           height: 500px;
                           overflow: auto;"></div>



   <script type=text/javascript>

        var homemap = L.map('homemap').setView([40.0150, -105.2705], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(homemap);


        var queryDict = {};
        location.search.substr(1).split("&").forEach(function(item) {queryDict[item.split("=")[0]] = item.split("=")[1]});

        var jstartlat='', jstartlng='', jendlat='', jendlng='';
        if ('startlat' in queryDict){
          jstartlat = queryDict['startlat'];
        }
        if ('startlng' in queryDict){
          jstartlng = queryDict['startlng'];
        }
        if ('endlat' in queryDict){
          jendlat = queryDict['endlat'];
        }
        if ('endlng' in queryDict){
          jendlng = queryDict['endlng'];
        }

        // not a great assumption, but fine since they should always be together
        if (typeof(jstartlat) != 'undefined' && jstartlat != null && jstartlat != '')
        {
          jstartlat = parseFloat(jstartlat);
          jstartlng = parseFloat(jstartlng);
        }

        if (typeof(jendlat) != 'undefined' && jendlat != null && jendlat != '')
        {
          jendlat = parseFloat(jendlat);
          jendlng = parseFloat(jendlng);
        }

        if  ((typeof(jstartlat) == 'undefined' || jstartlat == null || jstartlat == '') &&
             (typeof(jendlat) == 'undefined' || jendlat == null || jendlat == '')){

               homemap.on('click',
                 function(e){
                 var coord = e.latlng; // no need for toString()
                 var lat = coord.lat;
                 var lng = coord.lng;
                 var newMarker = L.marker(e.latlng, {draggable:'true'}).addTo(homemap)
                 .bindPopup('Start Point <a href="{{ url_for('mapclick') }}?startlat='+lat+'&startlng='+lng+'"> here</a>').openPopup();
               });

        }

        // Check if start lat and long have already been selected.
        // If they have, then persist the start point with an optional
        // reset button, and add in click detect for an end point. otherwise
        // just show the start point click detect.
        if (typeof(jstartlat) != 'undefined' && jstartlat != null && jstartlat != '') {

          // show point with reset button, but save end coords if they exist
          if (typeof(jendlat) != 'undefined' && jendlat != null && jendlat != '') {
              L.marker([jstartlat,jstartlng]).addTo(homemap)
                        .bindPopup('Start Point (<a href="{{ url_for('homepage') }}?endlat='+jendlat+'&endlng='+jendlng+'">reset</a>)')
                        .openPopup();

              L.marker([jendlat,jendlng]).addTo(homemap)
                                  .bindPopup('End Point (<a href="{{ url_for('homepage') }}?startlat='+jstartlat+'&startlng='+jstartlng+'">reset</a>)')
                                  .openPopup();
          } else {
            L.marker([jstartlat,jstartlng]).addTo(homemap)
                      .bindPopup('Start Point (<a href="{{ url_for('homepage') }}?">reset</a>)')
                      .openPopup();

            homemap.on('click',
               function(e){
                var coord = e.latlng; // no need for toString()
                var lat = coord.lat;
                var lng = coord.lng;
                var newMarker = L.marker(e.latlng, {draggable:'true'}).addTo(homemap)
                  .bindPopup('End Point <a href="{{ url_for('mapclick') }}?startlat='+jstartlat+'&startlng='+jstartlng+'&endlat='+lat+'&endlng='+lng+'"> here</a>').openPopup();
             });
          //   L.marker([40.0150, -105.2705]).addTo(homemap)
            //       .bindPopup('Boulder, CO.')
              //     .openPopup();


          }

        }

        //  L.marker([40.0150, -105.2705]).addTo(homemap)
        //      .bindPopup('Boulder, CO.')
        //      .openPopup();
        //}

        // Same as above, but for the end point
        if (typeof(jendlat) != 'undefined' && jendlat != null && jendlat != ''){
          // show point with reset button, but save start coords if they exist
          if (typeof(jstartlat) != 'undefined' && jstartlat != null && jstartlat !=''){
             L.marker([jstartlat,jstartlng]).addTo(homemap)
                      .bindPopup('Start Point (<a href="{{ url_for('homepage') }}?endlat='+jendtlat+'&endlng='+jendlng+'">reset</a>)')
                      .openPopup();

              L.marker([jendlat,jendlng]).addTo(homemap)
                        .bindPopup('End Point (<a href="{{ url_for('homepage') }}?startlat='+jstartlat+'&startlng='+jstartlng+'">reset</a>)')
                        .openPopup();
          } else {
            L.marker([jendlat,jendlng]).addTo(homemap)
                      .bindPopup('End Point (<a href="{{ url_for('homepage') }}?">reset</a>)')
                      .openPopup();

            // just in case
              homemap.on('click',
                function(e){
                var coord = e.latlng; // no need for toString()
                var lat = coord.lat;
                var lng = coord.lng;
                var newMarker = L.marker(e.latlng, {draggable:'true'}).addTo(homemap)
                .bindPopup('Start Point <a href="{{ url_for('mapclick') }}?startlat='+lat+'&startlng='+lng+'&endlat='+jendlat+'&endlng='+jendlng+'"> here</a>').openPopup();
              });
          }
       }
       //else {

        // homemap.on('click',
          // function(e,endlat,endlng){
    //       var coord = e.latlng; // no need for toString()
      //     var lat = coord.lat;
        //   var lng = coord.lng;
        //   var newMarker = L.marker(e.latlng, {draggable:'true'}).addTo(homemap)
        //   .bindPopup('End Point <a href="{{ url_for('mapclick') }}?startlat='+startlat+'&startlng='+startlng+'&endlat='+lat+'&endlng='+lng+'"> here</a>').openPopup();
        // });
      // }

        // var polylinePoints = [
      //          [40.0150, -105.2705], [39.9150, -105.3705]
      //   ];

        // var polyline = L.polyline(polylinePoints).addTo(homemap);



   </script>

 </div>


<div class="container">

   <div class="starter-template">
       <h2>Plan-It Trails</h2>
       <p></p>
   </div>


   <div class = "container">

  <!--
     <div class="container theme-showcase" role="main">
       <img src="static/images/test_map2.png" alt="Image" style="width:500px;height:500px;">
     </div>
-->


      <b1>Zoom and scroll on the map above to choose start / end points for your activity.</br>
          Choose only a start point to plan a round-trip route.</br>
          Note: Long routes (> 25 mi) and many routes (> 5) may
          take some time to compute. </b1>



     <form action="/model_input" method="POST">

       <div class="form-group">
         <label for="units">Units: </label>
         <input type="radio" id="units1" name='units' value="english" checked="checked">
         <label for="units1"> English (feet, miles) </label>
         <input type="radio" id="units2" name='units' value="metric">
         <label for="units2"> Metric (meters, kilometers) </label>
       </fieldset>
       </div>

       <div class="form-group">
         <label for="distance">Distance Range (mi):</label>
         <input type="number" step="0.1" id="mindistance" name='mindistance' min=1 max=200 placeholder="e.g. 10.0">
         <input type="hidden" name="mindistance" value="-1.0"/>
         <input type="number" step="0.1" id="maxdistance" name='maxdistance' min=1 max=200 placeholder="e.g. 15.0 ">
       </div>

       <div class="form-group">
         <label for="elevation">Elevation Range (ft):</label>
         <input type="number" id="minelevation" name='minelevation' min=0 max=100000  placeholder="e.g. 1000.0 ">
         <input type="number" id="maxelevation" name='maxelevation' min=0 max=100000  placeholder="e.g. 3000.0 ">
       </div>

       <div class="form-group">
         <label for="grade">Max Grade (percent):</label>
         <input type="number" id="maxgrade" name='maxgrade' min=0 max=100 placeholder="e.g.  5.0">
       </div>

       <div class="form-group">
         <label for="backtrack">Avoid Backtracking:</label>
         <input type="radio" id="backtrack1" name='backtrack' value="1">
         <label for="backtrack1"> low </label>
         <input type="radio" id="backtrack2" name='backtrack' value="2" checked="checked">
         <label for="backtrack2"> medium </label>
         <input type="radio" id="backtrack3" name='backtrack' value="3">
         <label for="backtrack3"> high </label>
         <input type="radio" id="backtrack4" name='backtrack' value="4">
         <label for="backtrack4"> very high </label>
       </fieldset>
       </div>

       <div class="form-group">
        <label for"numroutes">Number of Routes (up to 10):</label>
        <input type="number" name="numroutes" min="1" max="10" value=1>
       </div>

       <div class="form-group">
         <input id="startlat" name="startlat" type="hidden" value={{startlat}}>
         <input id="startlng" name="startlng" type="hidden" value={{startlng}}>
         <input id="endlat" name="endlat" type="hidden" value={{endlat}}>
         <input id="endlng" name="endlng" type="hidden" value={{endlng}}>
       </div>

       <div>
         <!-- action="{{url_for('model_input')}}" -->
         <button type="submit"  class="btn btn-default btn-lg">Generate Route!</button>
       </div>

     </form>

     <form action="/" method="GET">
       <div>
         <button type="submit"  class="btn btn-default btn-lg">Reset Map and Parameters</button>
       </div>
    </form>

   </div>

   <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
   <script src="static/js/bootstrap.min.js"></script>

 </div> <!-- /.container-->

  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="static/js/bootstrap.min.js"></script>
  </body>
</html>
